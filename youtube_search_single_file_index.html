<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>YouTube 채널 조회 (로컬 실행용)</title>
  <style>
    :root{--bg:#0f1724;--card:#0b1220;--muted:#9aa4b2;--accent:#3b82f6}
    html,body{height:100%;margin:0;font-family:Inter,system-ui,Apple SD Gothic Neo,'Malgun Gothic',sans-serif;background:linear-gradient(180deg,#071126 0%,#021024 100%);color:#e6eef8}
    .wrap{max-width:1100px;margin:32px auto;padding:24px}
    h1{font-size:20px;margin:0 0 12px}
    .controls{display:flex;gap:8px;margin-bottom:18px}
    input[type="search"]{flex:1;padding:10px 12px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:rgba(255,255,255,0.02);color:inherit;font-size:15px}
    button{background:var(--accent);border:none;color:white;padding:10px 14px;border-radius:8px;font-weight:600;cursor:pointer}
    .meta{color:var(--muted);font-size:13px;margin-bottom:12px}
    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(320px,1fr));gap:14px}
    .card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border:1px solid rgba(255,255,255,0.03);padding:12px;border-radius:12px;display:flex;gap:12px}
    .thumb{width:160px;flex-shrink:0;border-radius:8px;overflow:hidden}
    .thumb img{display:block;width:100%;height:90px;object-fit:cover}
    .info{flex:1;display:flex;flex-direction:column}
    .title{font-size:15px;font-weight:700;margin:0 0 6px}
    .title a{color:#fff;text-decoration:none}
    .ch{font-size:13px;color:var(--muted);margin-bottom:6px}
    .desc{font-size:13px;color:#d6e0ee;line-height:1.3;max-height:6.5em;overflow:hidden}
    .tags{margin-top:auto;display:flex;flex-wrap:wrap;gap:6px}
    .tag{font-size:12px;background:rgba(255,255,255,0.03);padding:6px 8px;border-radius:999px;color:var(--muted)}
    .empty{padding:24px;text-align:center;color:var(--muted)}
    .small{font-size:12px;color:var(--muted)}
    .loading{display:inline-block;padding:6px 10px;border-radius:8px;background:rgba(255,255,255,0.03);font-size:13px}
    footer{margin-top:20px;color:var(--muted);font-size:13px}
    @media (max-width:420px){.thumb{width:120px}.card{padding:10px}}
  </style>
</head>
<body>
  <div class="wrap">
    <h1>YouTube 영상 검색 (로컬 실행)</h1>
    <div class="controls">
      <input id="q" type="search" placeholder="검색어를 입력하세요 — 예: 강아지, ASMR, JavaScript 튜토리얼" />
      <button id="searchBtn">검색</button>
    </div>
    <div class="meta"><span id="status">API 키를 입력하고 검색을 눌러 시작하세요.</span></div>

    <div id="results" class="grid"></div>
    <div id="empty" class="empty">검색 결과가 여기에 표시됩니다.</div>

    <footer>
      <div class="small">주의: 이 코드는 클라이언트(브라우저)에서 직접 YouTube Data API 키를 사용합니다. 공개 키 노출에 주의하세요.</div>
    </footer>
  </div>

  <script>
    // -------------------- 설정 섹션 --------------------
    // 아래 YOUR_API_KEY_HERE 를 본인의 YouTube Data API 키로 바꿔주세요.
    const API_KEY = 'AIzaSyCIDK4ijtj543_k_nOrP0qQbPTWTIsYnwg';
    // --------------------------------------------------

    const qInput = document.getElementById('q');
    const btn = document.getElementById('searchBtn');
    const status = document.getElementById('status');
    const resultsEl = document.getElementById('results');
    const emptyEl = document.getElementById('empty');

    function setStatus(text){ status.textContent = text }

    async function fetchJson(url){
      const res = await fetch(url);
      if(!res.ok){
        const t = await res.text();
        throw new Error(res.status + ' ' + res.statusText + '\n' + t);
      }
      return res.json();
    }

    async function search(query){
      if(!API_KEY || API_KEY === 'YOUR_API_KEY_HERE'){
        setStatus('오류: API 키를 설정하세요. 코드 상단의 API_KEY 값을 수정하세요.');
        return;
      }
      if(!query || !query.trim()){
        setStatus('검색어를 입력하세요.');
        return;
      }

      setStatus('검색 중...');
      emptyEl.style.display = 'none';
      resultsEl.innerHTML = '';

      try{
        // 1) search.list로 videoId 목록 얻기
        const maxResults = 10;
        const sUrl = `https://www.googleapis.com/youtube/v3/search?part=snippet&type=video&maxResults=${maxResults}&q=${encodeURIComponent(query)}&key=${API_KEY}`;
        const sData = await fetchJson(sUrl);

        if(!sData.items || sData.items.length === 0){
          setStatus('결과 없음');
          emptyEl.style.display = '';
          return;
        }

        const videoIds = sData.items.map(it => it.id.videoId).filter(Boolean);

        // 2) videos.list로 상세 정보(태그 포함) 얻기
        const vUrl = `https://www.googleapis.com/youtube/v3/videos?part=snippet&id=${videoIds.join(',')}&key=${API_KEY}`;
        const vData = await fetchJson(vUrl);

        renderResults(vData.items || []);
        setStatus(`"${query}" 검색 완료 — ${vData.items ? vData.items.length : 0}개 반환`);

      }catch(err){
        console.error(err);
        setStatus('오류 발생 — 콘솔을 확인하세요. ' + (err.message||err));
        emptyEl.style.display = '';
      }
    }

    function renderResults(items){
      resultsEl.innerHTML = '';
      if(!items || items.length === 0){
        emptyEl.style.display = '';
        return;
      }
      emptyEl.style.display = 'none';

      for(const it of items){
        const snip = it.snippet || {};
        const title = snip.title || '';
        const desc = snip.description || '';
        const ch = snip.channelTitle || '';
        const tags = snip.tags || [];
        const thumb = (snip.thumbnails && (snip.thumbnails.medium||snip.thumbnails.default||snip.thumbnails.high)) || null;
        const videoUrl = 'https://www.youtube.com/watch?v=' + it.id;

        const card = document.createElement('div'); card.className = 'card';
        const thumbDiv = document.createElement('div'); thumbDiv.className = 'thumb';
        const img = document.createElement('img'); img.alt = title; img.src = thumb ? thumb.url : '';
        thumbDiv.appendChild(img);

        const info = document.createElement('div'); info.className = 'info';
        const tEl = document.createElement('h3'); tEl.className = 'title';
        const a = document.createElement('a'); a.href = videoUrl; a.target = '_blank'; a.rel = 'noopener noreferrer'; a.textContent = title;
        tEl.appendChild(a);

        const chEl = document.createElement('div'); chEl.className = 'ch'; chEl.textContent = ch;
        const dEl = document.createElement('div'); dEl.className = 'desc'; dEl.textContent = desc;

        const tagsWrap = document.createElement('div'); tagsWrap.className = 'tags';
        if(tags.length){
          for(const tg of tags.slice(0,10)){
            const tspan = document.createElement('span'); tspan.className = 'tag'; tspan.textContent = tg; tagsWrap.appendChild(tspan);
          }
        } else {
          const tspan = document.createElement('span'); tspan.className = 'tag'; tspan.textContent = '태그 없음'; tagsWrap.appendChild(tspan);
        }

        info.appendChild(tEl);
        info.appendChild(chEl);
        info.appendChild(dEl);
        info.appendChild(tagsWrap);

        card.appendChild(thumbDiv);
        card.appendChild(info);
        resultsEl.appendChild(card);
      }
    }

    // 이벤트 연결
    btn.addEventListener('click', ()=> search(qInput.value));
    qInput.addEventListener('keydown', (e)=>{ if(e.key === 'Enter') search(qInput.value) });

    // 샘플 검색(원하면 주석 해제)
    // qInput.value = 'JavaScript 튜토리얼'; search(qInput.value);
  </script>
</body>
</html>
